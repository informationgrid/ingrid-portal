<html>
<head>

<script type="text/javascript">
_container_.addOnLoad(function() {
	var msgDiv = dojo.byId("messageDiv");
	if (currentUdk.nodeAppType == "O")
		msgDiv.innerHTML = message.get("dialog.object.saveChangesHint");
	else
		msgDiv.innerHTML = message.get("dialog.address.saveChangesHint");
});

_container_.addOnUnload(function() {
	// If the dialog was cancelled via the dialogs close button
	// we need to signal an error (cancel action)
	if (_container_.customParams.resultHandler.fired == -1) {
		_container_.customParams.resultHandler.errback();
	}
});


// 'Yes Button' onClick function
// This function resets the dirty flag and publishes another save request
// TODO: After a successful save we have to load the clicked node 
saveChanges = function() {

	var def = new dojo.Deferred();
	def.addCallback(function(){
//		dojo.event.disconnect('after', udkDataProxy, 'onAfterSave', def, 'callback');
		_container_.customParams.resultHandler.callback("SAVE");
		_container_.closeWindow();
		}); 

	def.addErrback(function(){
		// On error fire the errorHandler. The caller has to handle the error
		_container_.customParams.resultHandler.errback();
		_container_.closeWindow();
	});

//	dojo.event.connectOnce('after', udkDataProxy, 'onAfterSave', def, 'callback');
	dojo.event.topic.publish("/saveRequest", {resultHandler:def});
}

// 'No Button' onClick function
// This function resets the dirty flag and publishes another load request 
discardChanges = function() {
	udkDataProxy.resetDirtyFlag();
	_container_.customParams.resultHandler.callback("DISCARD");
	_container_.closeWindow();
}

// 'Cancel Button' onClick function
// This function closes the dialog without saving or loading.
closeDialog = function() {
	_container_.customParams.resultHandler.errback();
	_container_.closeWindow();
}

</script>
</head>



<body>
<div dojoType="ContentPane">
	<div id="contentPane" layoutAlign="client" class="contentBlockWhite top half">
		<div id="dialogContent" class="content">
			<div id="messageDiv" class="field grey">
				&nbsp;		
			</div>

			<div class="inputContainer grey noSpaceBelow half" style="height:28px !important;">
		        <span style="float:right;"><button dojoType="ingrid:Button" title="Abbrechen" onClick="closeDialog">Abbrechen</button></span>
		        <span style="float:right;"><button dojoType="ingrid:Button" title="Nein" onClick="discardChanges">Nein</button></span>
		        <span style="float:right;"><button dojoType="ingrid:Button" title="Ja" onClick="saveChanges">Ja</button></span>
			</div>
	  	</div>
	</div>
</div>
</body>
</html>
