<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="de">
<head>
<script type="text/javascript" src="js/detail_helper.js"></script>
<script type="text/javascript">
_container_.addOnLoad(function() {
	var tree = dojo.widget.byId("tree");
	if (_container_.customParams.useDirtyData == true) {
		// get dirty data from proxy
		renderNodeData(udkDataProxy._getData());
	} else {
		// Construct an MdekDataBean from the available data
		var node = dojo.widget.byId(_container_.customParams.selectedNodeId);
		EntryService.getNodeData(node.id, node.appType, "false",
			{
				callback:function(res) { renderNodeData(res); },
				timeout:5000,
				errorHandler:function(message) {dojo.debug("Error in mdek_detail_view_dialog.html: Error while waiting for nodeData: " + message); }
			}
		);
	}
});

function renderNodeData(nodeData) {
	dojo.debugShallow(nodeData);
	renderObjectTitel(nodeData.objectName);
	renderText(nodeData.generalShortDescription);
	renderTextWithTitle(dojo.widget.byId("objectClass")._getDisplayValueForValue("Class"+nodeData.objectClass), "Objektklasse");
	renderTextWithTitle(nodeData.generalDescription, "Beschreibung");
	// addresses
	renderAddressList(nodeData.generalAddressTable);
	// technical domains
	
	
	// spatial reference
	renderSectionTitel("Raumbezug");
	renderTable(nodeData.spatialRefAdminUnitTable, ["name", "nativeKey", "longitude1", "latitude1", "longitude2", "latitude2"], ["Name", "AGS", "L&auml;nge 1", " Breite 1", "L&auml;nge 2", "Breite 2"], "Administrative Einheiten");
	renderTable(nodeData.spatialRefLocationTable, ["name", "longitude1", "latitude1", "longitude2", "latitude2"], ["Name", "L&auml;nge 1", " Breite 1", "L&auml;nge 2", "Breite 2"], "Freier Bezug");
	var altitudeData = [nodeData];
	// create cell render functions
	function lookupSpatialRefAltMeasure(val) {
		return dojo.widget.byId("spatialRefAltMeasure")._getDisplayValueForValue(val);
	}
	function lookupSpatialRefAltVDate(val) {
		return dojo.widget.byId("spatialRefAltVDate")._getDisplayValueForValue(val);
	}
	renderTable(altitudeData, ["spatialRefAltMin", "spatialRefAltMax", "spatialRefAltMeasure", "spatialRefAltVDate"], ["Min", "Max", "Ma&szlig;einheit", "Vertikaldatum"], "H&ouml;he", [null, null, lookupSpatialRefAltMeasure, lookupSpatialRefAltVDate]);
	renderTextWithTitle(nodeData.spatialRefExplanation, "Erl&auml;uterungen");

	// temporal reference
	renderSectionTitel("Zeitbezug");
	var timeRefTxt;
	if (nodeData.timeRefType == "von") {
		timeRefTxt = "von "+dojo.date.format(nodeData.timeRefDate1, {selector:'dateOnly', datePattern:'dd.MM.yyyy'})+" bis "+dojo.date.format(nodeData.timeRefDate2, {selector:'dateOnly', datePattern:'dd.MM.yyyy'});
	} else {
		timeRefTxt = nodeData.timeRefType+" "+dojo.date.format(nodeData.timeRefDate1, {selector:'dateOnly', datePattern:'dd.MM.yyyy'});
	}
	renderTextWithTitle(timeRefTxt, "Zeitbezug des Dateninhaltes");
	renderTextWithTitle(dojo.widget.byId("timeRefStatus")._getDisplayValueForValue(nodeData.timeRefStatus), "Status");
	renderTextWithTitle(dojo.widget.byId("timeRefPeriodicity")._getDisplayValueForValue(nodeData.timeRefPeriodicity), "Periodizit&auml;t");
	renderTextWithTitle("alle "+nodeData.timeRefIntervalNum+" "+dojo.widget.byId("timeRefIntervalUnit")._getDisplayValueForValue(nodeData.timeRefIntervalUnit), "Im Intervall");
	// create cell render functions
	function lookupTimeRefType(val) {
		return dojo.widget.byId("timeRefTypeCombobox")._getDisplayValueForValue(val);
	}
	function formatTimeRefDate(val) {
		return dojo.date.format(val, {selector:'dateOnly', datePattern:'dd.MM.yyyy'});
	}
	renderTable(nodeData.timeRefTable, ["date", "type"], ["Datum", "Typ"], "Zeitbezug des Datensatzes", [formatTimeRefDate, lookupTimeRefType]);
	renderTextWithTitle(nodeData.timeRefExplanation, "Erl&auml;uterungen");
	
	// additional information
	renderSectionTitel("Zusatzinformationen");
	renderTextWithTitle(dojo.widget.byId("extraInfoLangMetaData")._getDisplayValueForValue(nodeData.extraInfoLangMetaData), "Sprache des Metadatensatzes");
	renderTextWithTitle(dojo.widget.byId("extraInfoLangData")._getDisplayValueForValue(nodeData.extraInfoLangData), "Sprache des Datensatzes");
	renderTextWithTitle(dojo.widget.byId("extraInfoPublishArea")._getDisplayValueForValue(nodeData.extraInfoPublishArea), "Ver&ouml;ffentlichung");
	renderList(nodeData.extraInfoXMLExportTable, "XML-Export-Kriterium");
	renderList(nodeData.extraInfoLegalBasicsTable, "Rechtliche Grundlagen");
	renderTextWithTitle(nodeData.extraInfoPurpose, "Herstellungszweck");
	renderTextWithTitle(nodeData.extraInfoUse, "Eignung/Nutzung");
	
	// indexing
	renderSectionTitel("Verschlagwortung");
	renderList(nodeData.thesaurusTermsTable, "Thesaurus-Suchbegriffe", "title");
	renderList(nodeData.thesaurusTopicsList, "Themenkategorie", null, function (val) { return dojo.widget.byId("thesaurusTopicsCombobox")._getDisplayValueForValue(val);});
	renderList(nodeData.thesaurusFreeTermsTable, "Freie Suchbegriffe");
	renderTextWithTitle(nodeData.thesaurusEnvExtRes ? "Ja": "Nein", "Als Katalogseite anzeigen");
	renderList(nodeData.thesaurusEnvTopicsList , "Umweltthemen");
	renderList(nodeData.thesaurusEnvCatsList , "Umweltthemen");



	// references
	renderSectionTitel("Verweise");
	dojo.debugShallow(nodeData.linksToObjectTable);
	
	renderLinkedObjectListWithTitle(nodeData.linksFromObjectTable, "&Uuml;bergeordnete Objekte");
	renderLinkedObjectListWithTitle(nodeData.linksToObjectTable, "Untergeordnete Objekte");
	
}

function renderObjectTitel(val) {
	dojo.byId("detailViewContent").innerHTML += "<h1>" + val + "</h1><br/><br/>";
}

function renderSectionTitel(val) {
	dojo.byId("detailViewContent").innerHTML += "<br/><h2><u>" + val + "</u></h2><br/><br/>";
}

function renderTextWithTitle(val, title) {
	dojo.byId("detailViewContent").innerHTML += "<p><strong>" + title + "</strong><br/>" + val + "</p><br/>";
}

function renderLinkedObjectListWithTitle(list, title) {
	if (list.length > 0) {
		var t = "<strong>" + title + "</strong><br/><br/><p>";
		for (var i = 0; i < list.length; i++) {
			t += "<a href='javascript:menuEventHandler.handleSelectNodeInTree(\""+list[i].uuid+"\");'"+
			                    "title='"+list[i].title+"'>"+list[i].title+"</a>" + "<br/>";
		}
		dojo.byId("detailViewContent").innerHTML += t+"</p><br/><br/>";
	}
}

function renderAddressList(list) {
	if (list.length > 0) {
		var t = "";
		for (var i = 0; i < list.length; i++) {
			t += "<strong>" + list[i].nameOfRelation+ "</strong><br/><br/>";
			t += "<p>";
			t += detailHelper.renderAddressEntry(list[i]).replace(/\n/g, '<br />');
			t += "</p><br/>";
		}
		dojo.byId("detailViewContent").innerHTML += t + "<br/><br/>";
	}
}

function renderText(val) {
	if (val && val.length>0) {
		dojo.byId("detailViewContent").innerHTML += "<p>" + val + "</p><br/>";
	}
}

function renderList(list, title, rowProperty, renderFunction) {
	if (list && list.length > 0) {
		var t = "<p>";
		if (detailHelper.isValid(title)) {
			t += "<strong>" + title + "</strong><br/>";
		}
		var val;
		for (i=0; i<list.length; i++) {
			if (rowProperty) {
				val = list[i][rowProperty];
			} else {
				val = list[i];
			}
			if (renderFunction) {
				val = renderFunction.call(this, val);
			}
			t += val + "<br/>";
		}
		dojo.byId("detailViewContent").innerHTML += t + "</p><br/>";
	}	
}

function renderTable(list, rowProperties, listHeader, title, cellRenderFunction) {
	if (list && list.length > 0) {
		var t = "";
		if (detailHelper.isValid(title)) {
			t += "<strong>" + title + "</strong><br/><br/>";
		}
		t += "<p><table class=\"filteringTable\" cellspacing=\"0\">";
		if (listHeader && listHeader.length > 0) {
			t += "<thead class=\"fixedHeader\"><tr>";
			for (i=0; i<listHeader.length; i++) {
				t += "<th style=\"padding-right:4px\">"+listHeader[i]+"</th>";
			}
			t += "</tr></thead>";
		}
		t += "<tbody>";
		for (i=0; i<list.length; i++) {
			if (i % 2) {
				t += "<tr class=\"alt\">";
			} else {
				t += "<tr>";
			}
			for (j=0; j<rowProperties.length; j++) {
				if (cellRenderFunction && cellRenderFunction[j]) {
					t += "<td style=\"padding-right:4px\">"+cellRenderFunction[j].call(this, list[i][rowProperties[j]])+"</td>";
				} else {
					t += "<td style=\"padding-right:4px\">"+list[i][rowProperties[j]]+"</td>";
				}
			}
			t += "</tr>";
			
		}
		t += "</tbody></table></p>";
		dojo.byId("detailViewContent").innerHTML += t + "<br/><br/>";
	}
}

</script>
</head>

<body>
  <div dojoType="ContentPane">
    <div id="contentPane" layoutAlign="client" class="contentBlockWhite top">
      <div id="winNavi">
        <a href="javascript:printDivContent('detailViewContent')" title="Drucken">[Drucken]</a>
  	  </div>
  	  <div id="dialogContent" class="content">
        <!-- MAIN TAB CONTAINER START -->
        <div class="spacer"></div>
      	<div id="detailViewContainer" dojoType="ingrid:TabContainer" doLayout="false" class="full yNoScroll" selectedChild="detailView">
          <!-- MAIN TAB 1 START -->
      		<div id="detailView" dojoType="ContentPane" class="blueTopBorder h500 yScroll xNoScroll" label="Detail-Ansicht">
              <div id="detailViewContent" class="detailViewContentContainer w652 grey"></div>
      		</div>
          <!-- MAIN TAB 1 END -->
      	</div>
        <!-- MAIN TAB CONTAINER END -->
      </div>
    </div>
  </div>
  <!-- CONTENT END -->
</body>
</html>
