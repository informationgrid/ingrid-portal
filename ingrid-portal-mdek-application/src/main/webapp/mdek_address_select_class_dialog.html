<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<html>
<head>

<script type="text/javascript">
_container_.addOnLoad(function() {
	var msgDiv = dojo.byId("messageDiv");
//	msgDiv.innerHTML = dojo.string.substituteParams(message.get("dialog.addDescriptorsMessage"), _container_.customParams.descriptorTitle);
	msgDiv.innerHTML = message.get("dialog.createAddressMessage");
//	msgDiv.innerHTML += "<br> parentClass: " + _container_.customParams.parentClass;
//	msgDiv.innerHTML += "<br> parentId: " + _container_.customParams.parentId;


	var parentClass;
	if (typeof(_container_.customParams.parentClass) != "undefined") {
		parentClass = _container_.customParams.parentClass;

	} else if (_container_.customParams.parentId == "addressRoot") {
		parentClass = -1;

	} else if (_container_.customParams.parentId == "addressFreeRoot") {
		// This should never be the case...
		parentClass = -2;
	}

	// Init the select box dp
	var addressClassWidget = dojo.widget.byId("addressClassSelect");
	var valueList = [];
	switch (parentClass) {
		case -2:	// Free Address Root
			valueList.push([message.get("address.type.custom"), 3]);
			break;

		case -1: // Root Address
			valueList.push([message.get("address.type.institution"), 0]);
			valueList.push([message.get("address.type.custom"), 3]);
			break;

		case 0:	// Institution
			valueList.push([message.get("address.type.institution"), 0]);
			valueList.push([message.get("address.type.unit"), 1]);
			valueList.push([message.get("address.type.person"), 2]);
			break;

		case 1:	// Unit
			valueList.push([message.get("address.type.unit"), 1]);
			valueList.push([message.get("address.type.person"), 2]);
			break;

		case 2:	// Person (a person must not have any subAddresses)
			dojo.debug("Error in select address class dialog - A 'person' is not allowed to have any sub addresses!");
			break;

		case 3:	// Custom Address (a custom address must not have any subAddresses)
			dojo.debug("Error in select address class dialog - A 'custom address' is not allowed to have any sub addresses!");
			break;

		default:
			dojo.debug("Error in select address class dialog - Unknown parent address type: "+parentClass);
			break;
	}
	addressClassWidget.dataProvider.setData(valueList);
	addressClassWidget.setValue(valueList[0][1]);
});


_container_.addOnUnload(function() {
	// If the dialog was cancelled via the dialogs close button
	// we need to signal an error (cancel action)
	if (_container_.customParams.resultHandler.fired == -1) {
		_container_.customParams.resultHandler.errback();
	}
});


// 'Yes Button' onClick function
this.yesButtonFunc = function() {
	// Callback with selected address class
	_container_.customParams.resultHandler.callback(parseInt(dojo.widget.byId("addressClassSelect").getValue()));
	_container_.closeWindow();
}

// 'No Button' onClick function
this.noButtonFunc = function() {
	_container_.customParams.resultHandler.errback();
	_container_.closeWindow();
}

</script>
</head>

<body>
<div dojoType="ContentPane">
	<div id="contentPane" layoutAlign="client" class="contentBlockWhite top">
		<div id="dialogContent" class="content">
			<div id="messageDiv" class="field grey w296">
			</div>

			<div>
			  <input dojoType="ingrid:Select" autoComplete="false" style="width:285px;" id="addressClassSelect" />
			</div>

			<div class="inputContainer grey noSpaceBelow half" style="height:30px;">
		        <span style="float:right; margin-top:5px;"><button dojoType="ingrid:Button" title="Abbrechen" onClick="javascript:scriptScope.noButtonFunc();">Abbrechen</button></span>
		        <span style="float:right; margin-top:5px;"><button dojoType="ingrid:Button" title="Adresse anlegen" onClick="javascript:scriptScope.yesButtonFunc();">Adresse anlegen</button></span>
			</div>
	  	</div>
	</div>
</div>
</body>
</html>
