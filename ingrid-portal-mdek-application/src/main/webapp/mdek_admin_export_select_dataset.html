<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="de">
<head>
<title>Objekt zuordnen</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="author" content="wemove digital solutions" />
<meta name="copyright" content="wemove digital solutions GmbH" />

<script type="text/javascript">
var scriptScope = this;

_container_.addOnLoad(function() {
	init();
});
_container_.addOnUnload(function() {
	// If the dialog was cancelled via the dialogs close button
	// we need to signal an error (cancel action)
	if (_container_.customParams.resultHandler.fired == -1) {
		_container_.customParams.resultHandler.errback();
	}
});

function init() {
	// Deferred object which is called when the Tree has been initialized.
	// After the tree has been initialized, the tree is expanded to the targetNode
	// specified in the customParameter 'jumpToNode' 
	var treeInitDef = new dojo.Deferred();

	// Load initial first level of the tree from the server
	TreeService.getSubTree(null, null, 1, 
		function (str) {
			var tree = dojo.widget.byId('selectDatasetTree');
			tree.setChildren(str);
	});

	// Load children of the node from server
	// Overwritten to work with dwr.
	var treeController = dojo.widget.byId("selectDatasetTreeController");
	treeController.loadRemote = function(node, sync){
		var _this = this;

		var params = {
			node: this.getInfo(node),
			tree: this.getInfo(node.tree)
		};

		var deferred = new dojo.Deferred();

		deferred.addCallback(function(res) {
			dojo.lang.forEach(res, function(obj){
				obj.title = dojo.string.escape("html", obj.title);
				obj.uuid = obj.id;
				obj.id = null;
			});
			return _this.loadProcessResponse(node,res);
		});
		deferred.addErrback(function(res) { dialog.show(message.get("general.error"), message.get("tree.loadError"), dialog.WARNING); dojo.debug(res); return res;});

		TreeService.getSubTree(node.id.substring(10, node.id.length), node.nodeAppType, 1, {
  			callback:function(res) { deferred.callback(res); },
			errorHandler:function(message) { deferred.errback(new dojo.RpcError(message, this)); },
			exceptionHandler:function(message) { deferred.errback(new dojo.RpcError(message, this)); }
  		});

		return deferred;
	};
};

scriptScope.selectDataset = function() {
	var node = dojo.widget.byId("selectDatasetTree").selectedNode;
	if (node) {
		var retVal = {};
		retVal.uuid = node.uuid;
		retVal.title = node.title;
/*
	var nodeId = null;
	dojo.debug("node.id: "+node.id);
	dojo.debug("node.uuid: "+node.uuid);
	if (typeof(node.id) != "undefined") {
		// Remove the prefix from the nodeId
		nodeId = node.uuid;
	}

	if (nodeId == null) {
		showStatisticsForCatalog();

	} else if (nodeId == "objectRoot") {
		showStatisticsForAllObjects();

	} else if (nodeId == "addressRoot") {
		showStatisticsForAllAddresses();

	} else if (nodeId == "addressFreeRoot") {
		showStatisticsForAllFreeAddresses();

	} else if (node.nodeAppType == "A") {
		showStatisticsForAddress(nodeId);

	} else if (node.nodeAppType == "O") {
		showStatisticsForObject(nodeId);

	} else {
		// TODO Show error message?
		dojo.debug("clicked unknown node with id '"+nodeId+"'");
	}
*/
		_container_.customParams.resultHandler.callback(retVal);
	}

	_container_.closeWindow(); 
}

</script>
</head>

<body>

<div dojoType="ContentPane">

  <div id="catalogueObject" class="contentBlockWhite top w478">
    <div id="winNavi">
      <a href="#" title="Hilfe">[?]</a>
	  </div>
	  <div id="objectContent" class="content">

      <!-- CONTENT START -->
      <div class="inputContainer w478 h413 scrollable">
      	<div dojoType="ContentPane" id="treeContainerAssignObj">
          <!-- tree components -->
          <div dojoType="ingrid:TreeController" widgetId="selectDatasetTreeController" RpcUrl="server/treelistener.php"></div>
          <div dojoType="ingrid:TreeListener" widgetId="selectDatasetTreeListener"></div>	
          <div dojoType="ingrid:TreeDocIcons" widgetId="selectDatasetTreeDocIcons"></div>	
          <div dojoType="ingrid:TreeDecorator" listener="selectDatasetTreeListener"></div>
          
          <!-- tree -->
          <div dojoType="ingrid:Tree" listeners="selectDatasetTreeController;selectDatasetTreeListener;selectDatasetTreeDocIcons" widgetId="selectDatasetTree">
		  </div>
        </div>
        <div class="spacer"></div>
      </div>
      <div class="inputContainer w478">
        <span class="button w442 transparent">
		  <span style="float:right;"><button dojoType="ingrid:Button" onClick="javascript:scriptScope.selectDataset()">Ausw&auml;hlen</button></span>
        </span>
  	  </div>
      <!-- CONTENT END -->

    </div>
  </div>
</div>

</body>
</html>
