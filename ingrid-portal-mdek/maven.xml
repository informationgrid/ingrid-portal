<project default="war:install"
         xmlns:j="jelly:core" 
         xmlns:define="jelly:define"
		 xmlns:maven="jelly:maven"
		 xmlns:ant="jelly:ant">

 
  <!-- ================================================================ -->
  <!-- Hot Deploy for mundane everyday development under Catalina       -->
  <!-- ================================================================ -->
  <goal name="hotdeploy">
    <echo message="Hot Deploying ${org.apache.jetspeed.portlet.app.name} to ${org.apache.jetspeed.deploy.war.dir}"/>
    <copy todir="${org.apache.jetspeed.deploy.war.dir}/${org.apache.jetspeed.portlet.app.name}/WEB-INF/classes">
        <fileset dir="${maven.build.dir}/classes">
        </fileset>
    </copy>
    <copy todir="${org.apache.jetspeed.deploy.war.dir}/${org.apache.jetspeed.portlet.app.name}/">
      <fileset dir="./src/webapp">
      </fileset>
    </copy>
  </goal>

  <preGoal name="hotdeploy">
   <attainGoal name= "java:compile"/> 
  </preGoal>

  <preGoal name="hotdeploywar">
   <attainGoal name= "war"/>
  </preGoal>

  <goal name="hotdeploywar">
    <echo message="Hot Deploying war for ${org.apache.jetspeed.portlet.app.name} to ${org.apache.jetspeed.deploy.war.dir}/jetspeed/WEB-INF/deploy"/>

    <copy todir="${org.apache.jetspeed.deploy.war.dir}/jetspeed/WEB-INF/deploy" 
		file="${maven.build.dir}/${maven.war.final.name}">
      
    </copy>
  </goal>

  <!-- MANIFEST Stuff -->
  <preGoal name="war:war">
  	<loadfile property="svn.version" srcFile=".svn/entries" failonerror="true">
		<filterchain>
			<headfilter lines="6"/>
				<tokenfilter>
					<filetokenizer/>
					<replaceregex pattern=".*[\r\n]+dir[\r\n]+([0-9]+)[\r\n]+https://.*" flags="s" replace="\1"/>
				</tokenfilter>
		</filterchain>
	</loadfile>
	<ant:tstamp/>
	<j:set var="manifestFile" value="${maven.build.dir}/${pom.artifactId}/META-INF/MANIFEST.MF"/>
	<!-- delete file="${manifestFile}"/ -->
	<ant:manifest file="${manifestFile}">
		<attribute name="Build-Timestamp" value="${DSTAMP}${TSTAMP}" />
		<attribute name="Build-SVN-Revision" value="${svn.version}" />
		<attribute name="Build-Version" value="${pom.currentVersion}" />
	</ant:manifest>
	<maven:set plugin="maven-war-plugin" property="maven.war.manifest" value="${manifestFile}" />
  </preGoal>

</project>