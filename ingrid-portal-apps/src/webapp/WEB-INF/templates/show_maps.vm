#set ($contextPath = $renderRequest.getAttribute('org.apache.jetspeed.request.RequestContext').getRequest().getContextPath())
#set ($action = $renderResponse.createActionURL())
<iframe id="iframe_map" allowfullscreen></iframe>

<script>
var buffer = 0; //scroll bar buffer
var iframe = document.getElementById('iframe_map');
var urlParams = location.search;

// Add iFrame 'src'
iframe.src = '/ingrid-webmap-client/frontend/index.ingrid.dev.html' + urlParams;

// .onload doesn't work with IE8 and older.
if (iframe.attachEvent) {
    iframe.attachEvent('onload', resizeIframe);
} else {
    iframe.onload=resizeIframe;
}

// Resize map
window.onresize = resizeIframe;

function pageY(elem) {
    return elem.offsetParent ? (elem.offsetTop + pageY(elem.offsetParent)) : elem.offsetTop;
}

function resizeIframe() {
    var height = document.documentElement.clientHeight;
    height -= pageY(document.getElementById('iframe_map'))+ buffer ;
    height = (height < 0) ? 0 : height;
    document.getElementById('iframe_map').style.height = height + 'px';
}

// Change params
function onParamChange(params, p){
    var newParams = '?';
    var key = [];
    for (var i in params) {
        key.push(i);
    };

    key.forEach(function (s, i, o) {
        if(i == 'lang'){
            newParams = newParams + '' + s + '=' + '$lang';
        }else{
            newParams = newParams + '' + s + '=' + params[s];
        }
        if(i < o.length - 1){
            newParams = newParams + '&';
        }
    });

    if(newParams){
        window.history.pushState('', '', newParams );
    }
}
</script>