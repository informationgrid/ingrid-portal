#macro (renderNode $node)
	## NOTICE: NO FLOATS IN VELOCITY MATHs ! Use e.g. (3/2) instead ! :-(
	#set ($leftMargin = ($node.level - 1) * 25)
	#set ($iconLayerWidth = 30)
	#set ($textLayerWidth = 568 - $leftMargin - $iconLayerWidth)
    
	#set ($action = $renderResponse.createActionURL())
	$action.setParameter('topicID',$node.get("topicID"))
	$action.setParameter('nodeId',$node.id)
	<p style="margin-left:${leftMargin}px; clear:left; overflow:hidden">	
	## render +/- and icon
	#set($nodeIcon = "ico_tree_folder_close.gif")
	#set($nodeAlt = "$MESSAGES.getString('common.alt.icon.folder')")
    #set ($url = "/ingrid-portal/portal/search-catalog/search-catalog-thesaurus.psml")

	## render +/- and icon
	<span style="float:left; width:${iconLayerWidth}px;">
	#if($node.isOpen())
		#set ($renderSubNodes = true)
		## render "-" and icon WITH ACTION -> node can be closed
		##$action.setParameter('action','doCloseNode')
		<a href="$url?action=doCloseNode&q=$node.name&nodeId=$node.get("topicID")&parentNodes=$node.getAllParentsAsString()"><img src="/ingrid-portal-apps/images/ico_tree_open.gif" alt="$MESSAGES.getString('common.alt.icon.minus')" /></a>
   		<a href="$url?action=doCloseNode&q=$node.name&nodeId=$node.get("topicID")&parentNodes=$node.getAllParentsAsString()"><img src="/ingrid-portal-apps/images/$nodeIcon" alt="$nodeAlt" title="$nodeAlt" /></a>
	#else
		#set ($renderSubNodes = false)
		#if ($node.expandable)
			## render "+" and icon WITH ACTION -> node not opened yet and can be expanded 
			##$action.setParameter('action','doOpenNode')
			<a href="$url?action=doOpenNode&q=$node.name&nodeId=$node.get("topicID")&parentNodes=$node.getAllParentsAsString()"><img src="/ingrid-portal-apps/images/ico_tree_close.gif" alt="$MESSAGES.getString('common.alt.icon.plus')" /></a>
			<a href="$url?action=doOpenNode&q=$node.name&nodeId=$node.get("topicID")&parentNodes=$node.getAllParentsAsString()"><img src="/ingrid-portal-apps/images/$nodeIcon" alt="$nodeAlt" title="$nodeAlt" /></a>
		#else
			## render nothing
			&nbsp;
		#end
	#end
	</span>

	## render node text differently depending on the type and if it's currently selected
	<span id="$node.id" style="float:left; width:${textLayerWidth}px;">
    	##$action.setParameter('action','doSearch')
        ##	<a href="$action">$node.name (Node Level: $node.level, numChildren: $node.getChildren().size())</a>
    	#if ($node.type == 0) ## TopTerm Type
    	    <strong>$node.name</strong>
    	#elseif ($node.type == 1) ## NodeLabel Type
    	    <strong>$node.name</strong>
    	#elseif ($node.type == 2) ## Descriptor Type
    	  #if ($node.name == $ps.currentQueryTerm)
            <strong><a href="$url?action=doSearch&q=$node.name&nodeId=$node.get("topicID")&parentNodes=$node.getAllParentsAsString()"><span style="text-decoration:underline">$node.name</span></a></strong>
    	    <!--<strong><a href="$action"><span style="text-decoration:underline">$node.name</span></a></strong>-->
    	  #else
            <strong><a href="$url?action=doSearch&q=$node.name&nodeId=$node.get("topicID")&parentNodes=$node.getAllParentsAsString()">$node.name</a></strong>
    	    <!--<strong><a href="$action">$node.name</a></strong>-->
    	  #end
    	#elseif ($node.type == -1) ## SNS Error Type
    		<strong>$MESSAGES.getString('searchCatThesaurus.tree.snsErrorText')</strong>
    	#else ## We could display a local error here
    		<strong>$MESSAGES.getString('searchCatThesaurus.tree.snsErrorText')</strong>
    	#end
	</span>
	</p>
	## render sub nodes
	#if ($renderSubNodes)
		#foreach($childNode in $node.getChildren())
			#renderNode($childNode)
		#end
	#end
#end

<div class="section">    
  #parse ('/WEB-INF/templates/search_catalog/include_tabs_cat.vm')
  #parse ('/WEB-INF/templates/search_catalog/include_tabs_cat_thesaurus.vm')
  <div class="formbody formbody_border_style">
	#foreach($termNode in $ps.thesRoot.getChildren())
	  #renderNode($termNode)
    #end
  </div>
  #set ($action = $renderResponse.createActionURL())
  <form action="$action" method="post" enctype="" name="extsearch" id="extsearch">
    <div class="formfooter formfooter_border_style">
      <div align="right">
        <input class="btn" type="submit" name="submitReload" value="$MESSAGES.getString('searchCatHierarchy.submit.reload')" />
      </div>
    </div>
  </form>
</div>