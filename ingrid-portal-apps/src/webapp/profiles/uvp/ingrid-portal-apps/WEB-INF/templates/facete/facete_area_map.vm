#set ($action = $renderResponse.createActionURL())
<ul class="accordion filter-group" data-accordion="" data-multi-expand="true" data-allow-all-closed="true" role="tablist" data-e="">
    <li id="facet_area_map_header" class="accordion-item is-active" data-accordion-item="" onclick="resizeMap()">
        <a href="" class="accordion-title" aria-controls="facet-map-accordion" role="tab" id="facet-map-accordion-label" #if($selectedMap)aria-expanded="true" aria-selected="true"#end>
            <span class="text">$MESSAGES.getString("searchResult.facete.area.map.search")</span>
        </a>
        <div class="accordion-content map" data-tab-content="" role="tabpanel" aria-labelledby="facet-map-accordion-label" id="facet-map-accordion" #if($selectedMap)aria-hidden="true"#end style="display:block;">
            <div id="map" class="map-ingrid" style="height:320px;">
            </div>
            <div class="map-filter-xs"></div>
            <p class="subtext">$MESSAGES.getString("common.map.info")</span></small></p>
            <form action="$action" method="post" name="facete_map_form">
                <input id="x1" name="x1" type="hidden" />
                <input id="x2" name="x2" type="hidden" />
                <input id="y1" name="y1" type="hidden" />
                <input id="y2" name="y2" type="hidden" />
                <input id="areaid" name="areaid" type="hidden" />
                #renderInputButtonDialog($MESSAGES.getString('searchResult.facete.dialog.commit') "width:100%;" "doAddMap" $MESSAGES.getString('searchResult.facete.dialog.tooltip.commit') "button filter_submit" "getMapBounds()")
            </form>
        </div>
    </li>
</ul>

#parse("/WEB-INF/templates/global/include_leaflet_header.vm")
<script language="JavaScript" type="text/javascript">
    var osm = getOSMLayer('');
    var map = addLeafletMap([osm]);
    map.scrollWheelZoom.disable();
    var enablePopUp = false;
    var smallIcons = true;
    
    if('$selectedMap.webmapclientCoords'.indexOf("y1") === -1){
        $( document ).ready(function() {
            $('#facet_area_map_header').each(function(index) {
                var div = $(this);
                div.removeClass('is-active');
            });
            $('#facet_area_map_header .accordion-content').each(function(index) {
                var div = $(this);
                div.css('display', 'none');
            });
            $('#facet_area_map_content').each(function(index) {
                var div = $(this);
                div.addClass('is-hidden');
            });
        });
    }
    
    window.onresize = function(event) {
        resizeMap();
    };

    function getMapBounds(){
        if(map.getBounds().isValid()) {
            $('#x1').prop("value", map.getBounds().getWest());
            $('#x2').prop("value", map.getBounds().getEast());
            $('#y1').prop("value", map.getBounds().getSouth());
            $('#y2').prop("value", map.getBounds().getNorth());
        }
    }

    function resizeMap(){
        if(map){
            map._onResize();
        }
    }
</script>
#parse("/WEB-INF/templates/global/include_leaflet_marker.vm")
<script>
    addLeafletHomeControl(map, 'Zoom auf initialen Kartenausschnitt', 'topleft', 'ic-ic-center', mapBounds, '', '23px');
</script>
