<script>
  var all = $('.list-item a.icon').map(function() {
    var href = this.href;
    var os = getOS();
    var addButton = false;
    var hrefChanged = false;
    var clipboardText = '';
    var domain = '';
    if(os === 'Windows') {
      if(href.indexOf('https://dl.datenfinder.baw.de/KA/') > -1) {
        domain = '';
        var replaceString = domain + '/net/lfs-hh/Ablage/HH/';
        href = href.replaceAll('https://dl.datenfinder.baw.de/KA/', replaceString);
        hrefChanged = true;
      }
      if(href.indexOf('https://dl.datenfinder.baw.de/HH/') > -1) {
        domain = 'file://lfs-hh.all.baw.de';
        var replaceString = domain + '/Ablage/HH/';
        href = href.replaceAll('https://dl.datenfinder.baw.de/HH/', replaceString);
        hrefChanged = true;
      }
    } else {
      if(href.indexOf('https://dl.datenfinder.baw.de/KA/') > -1) {
        domain = 'smb://lfs-ka.all.baw.de';
        var replaceString = domain + '/Ablage/KA/';
        href = href.replaceAll('https://dl.datenfinder.baw.de/KA/', replaceString);
        hrefChanged = true;
      }
      if(href.indexOf('https://dl.datenfinder.baw.de/HH/') > -1) {
        domain = '';
        var replaceString = domain + '/net/lfs-hh/Ablage/HH/';
        href = href.replaceAll('https://dl.datenfinder.baw.de/HH/', replaceString);
        hrefChanged = true;
      }
    }
    if(this.href !== href || this.href.indexOf('file:') == 0) {
      this.style.pointerEvents = 'none';
      addButton = true;
    }
    this.href = href;
    if(hrefChanged) {
      clipboardText += domain;
      clipboardText += this.pathname;
    }
    if(addButton) {
      var parent = $(this).parent();
      ## Add copy button
      var copyBtn = $('<button class="btn copy" data-clipboard-text="' + (clipboardText || this.href) + '" style="float:right" title="$MESSAGES.getString('common.link.copy')"><span class="ic-ic-copy"></span></button>');
      parent.append(copyBtn);
      ## Add info button to title
      var infoBtn = $('<a href="#" class="js-popup copy" data-content="$MESSAGES.getString('common.link.copy.help')" style="float:right;"><span class="ic-ic-info"></span></a>');
      var header = parent.closest('.sub-section').children('h4');
      if(header) {
        if(header.children('a.copy').length == 0) {
          header.append(infoBtn);
        }
      }
    }
  }).get();

  var btns = document.querySelectorAll('.btn.copy');
  
  var clipboard = new ClipboardJS(btns);
  clipboard.on('success', function (e) {
    showTooltip(e.trigger,'$MESSAGES.getString("common.link.copy.success")')
  });
  clipboard.on('error', function (e) {
    console.log('Action:', e.action);
  });
  
  for(var i=0;i<btns.length;i++){
    btns[i].addEventListener('mouseleave',clearTooltip);
    btns[i].addEventListener('blur',clearTooltip);
  }
  
  for(var i=0;i<btns.length;i++){
    btns[i].addEventListener('mouseleave',clearTooltip);
    btns[i].addEventListener('blur',clearTooltip);
  }
  function clearTooltip(e){
    e.currentTarget.setAttribute('class','btn');
    e.currentTarget.removeAttribute('aria-label');
  }
  function showTooltip(elem,msg){
    elem.setAttribute('class','btn tooltipped tooltipped-s');
    elem.setAttribute('aria-label',msg);
  }
</script>