<script>
  var all = $('.list-item a.icon').map(function() {
    var href = this.href;
    var os = getOS();
    var addButton = false;
    if(os === 'Windows') {
      href = href.replaceAll('https://dl.datenfinder.baw.de/KA/', '\\\\lfs-ka.all.baw.de\\Ablage\\KA\\');
      href = href.replaceAll('https://dl.datenfinder.baw.de/HH/', '\\\\lfs-hh.all.baw.de\\Ablage\\HH\\');
    } else {
      href = href.replaceAll('https://dl.datenfinder.baw.de/KA/', 'smb://lfs-ka.all.baw.de/Ablage/KA/');
      href = href.replaceAll('https://dl.datenfinder.baw.de/HH/', 'smb://lfs-hh.all.baw.de/Ablage/HH/');
    }
    if(this.href !== href || this.href.indexOf('file:') == 0) {
      addButton = true;
    }
    this.href = href;
    if(addButton) {
      var parent = $(this).parent();
      ## Add copy button
      var copyBtn = $('<button class="btn copy" data-clipboard-text="' + this.href+ '" style="float:right" title="$MESSAGES.getString('common.link.copy')"><span class="ic-ic-copy"></span></button>');
      parent.append(copyBtn);
      ## Add info button to title
      var infoBtn = $('<a href="#" class="js-popup copy" data-content="$MESSAGES.getString('common.link.copy.help')" style="float:right;"><span class="ic-ic-info"></span></a>');
      var header = parent.closest('.sub-section').children('h4');
      if(header) {
        if(header.children('a.copy').length == 0) {
          header.append(infoBtn);
        }
      }
    }
  }).get();

  var btns = document.querySelectorAll('.btn.copy');
  
  var clipboard = new ClipboardJS(btns);
  clipboard.on('success', function (e) {
    showTooltip(e.trigger,'$MESSAGES.getString("common.link.copy.success")')
  });
  clipboard.on('error', function (e) {
    console.log('Action:', e.action);
  });
  
  for(var i=0;i<btns.length;i++){
    btns[i].addEventListener('mouseleave',clearTooltip);
    btns[i].addEventListener('blur',clearTooltip);
  }
  
  for(var i=0;i<btns.length;i++){
    btns[i].addEventListener('mouseleave',clearTooltip);
    btns[i].addEventListener('blur',clearTooltip);
  }
  function clearTooltip(e){
    e.currentTarget.setAttribute('class','btn');
    e.currentTarget.removeAttribute('aria-label');
  }
  function showTooltip(elem,msg){
    elem.setAttribute('class','btn tooltipped tooltipped-s');
    elem.setAttribute('aria-label',msg);
  }
</script>