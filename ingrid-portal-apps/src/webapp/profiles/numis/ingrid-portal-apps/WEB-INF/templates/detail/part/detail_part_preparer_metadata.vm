#parse("/WEB-INF/templates/detail/part/metadata/detail_metadata_settings.vm")

<div class="detail" id="detail">
#if($title)
    <div class="filter hide-for-large">
        <div class="teaser-data search">
            #parse("/WEB-INF/templates/detail/part/metadata/detail_metadata_part_section_navigation.vm")
        </div>
    </div>
    <div class="banner-noimage">
        <div class="page-wrapper" style="background-image: url('/decorations/layout/uvp/images/template/drops-subpage.svg');">
            <div class="row">
                <div class="xsmall-24 large-6 xlarge-6 columns">
                    <a class="helper icon" href="$renderResponse.encodeURL('/portal/main-search.psml')">
                        <span class="ic-ic-arrow-left"></span>
                        <span class="text text-normal">$MESSAGES.getString("search.detail.back.to.results")</span>
                    </a>
                </div>
                <div class="xsmall-24 large-18 xlarge-18 columns">
                    <div class="helper icon">
                        #renderUDKIcon($type $Codelists.getCodeListValue('8000', ${type}, $lang))
                    </div>
                    #renderSearchTerm($searchTerm)
                    <h2>$title</h2>
                </div>
            </div>
        </div>
    </div>
    <div class="row nav-content search-filtered">
        ## Navigation
        <div class="xsmall-24 large-6 xlarge-6 columns show-for-large">
            <div class="filter">
                <div class="teaser-data search">
                    #parse("/WEB-INF/templates/detail/part/metadata/detail_metadata_part_section_navigation.vm")
                </div>
            </div>
        </div>
        <div class="xsmall-24 large-18 xlarge-18 columns">
            <div class="data">
        ## FactSheet
                #parse("/WEB-INF/templates/detail/part/metadata/detail_metadata_part_section_factsheet.vm")
            </div>
        ## Beschreibung
            #parse("/WEB-INF/templates/detail/part/metadata/detail_metadata_part_section_description.vm")
        ## Darstellung
            #parse("/WEB-INF/templates/detail/part/metadata/detail_metadata_part_section_presentation.vm")
        ## Links und Downloads
            #parse("/WEB-INF/templates/detail/part/metadata/detail_metadata_part_section_links.vm")
        ## Nutzung
            #parse("/WEB-INF/templates/detail/part/metadata/detail_metadata_part_section_use.vm")
        ## Fachinformationen
            #parse("/WEB-INF/templates/detail/part/metadata/detail_metadata_part_section_information.vm")
       ## Datenqualit√§t
            #parse("/WEB-INF/templates/detail/part/metadata/detail_metadata_part_section_dataquality.vm")
        ## Extras
            #parse("/WEB-INF/templates/detail/part/metadata/detail_metadata_part_section_extras.vm")
        ## Additional Fields Example
            #parse("/WEB-INF/templates/detail/part/metadata/detail_metadata_part_section_additional_fields.vm")
            </div>
        </div>
    </div>
#end
</div>
#parse("/WEB-INF/templates/detail/part/metadata/detail_metadata_part_script_table_scroll.vm")

#macro (renderDate $dateTitle $dateFrom $dateTo $info)
    #if($dateFrom || $dateTo)
        <h4 class="no-margin">
            $dateTitle
            #if($info)
                <span class="ic-ic-info js-popup" data-title="Hinweis" data-content="$info"></span>
            #end
        </h4>
        <p>
        #if($dateFrom)
            $dateFrom
        #end
        #if($dateTo)
            - $dateTo
        #end
        </p>
    #end
#end

#macro (renderTableToTree $title $entries $tableId)
    #if($entries.get("children"))
        #if($title)
            <h3 class="title-font">$title</h3>
        #end
        <div class="document-list">
        #foreach($entry in $entries.get("children"))
            <div class="list-item">
                #renderTreeFolder($entry)
            </div>
        #end
        </div>
    #end
#end

#macro (renderTreeFolder $entry)
    #set($entryLabel = "")
    #if($entry.get('label'))
        #set($entryLabel = "$TOOL.getDecodeValue($entry.get('label'))")
    #end
    #if($entryLabel && $entryLabel.length() > 0)
        #set($entryLink = "")
        #if($entry.get('link'))
            #set($entryLink = "$entry.get('link')")
        #end
        #if($entryLink && $entryLink.length() > 0)
            <a class="link download" href="$entry.get('link')" title="$entryLabel" target="_blank" rel="noopener noreferrer">
                $entryLabel
            </a>
            <span class="text">
            (
            #set ($entryLinkSplit = $TOOL.getDecodeValue($entryLink).split("/"))
            #set ($entryLinkSplitSize = $entryLinkSplit.size() - 1)
            $entryLinkSplit.get($entryLinkSplitSize)
            <span class="downloadText"></span>
            )
            </span>
        #else
            <span>$entryLabel</span>
        #end
    #end
    #if($entry.get('children'))
        #foreach($subEntry in $entry.get('children'))
        <li class="folder__content js-accordion-content">
            <ul class="js-accordion-multi">
                <li class="folder__item">
                    #renderTreeFolder($subEntry)
                </li>
            </ul>
        </li>
        #end
    #end
#end

#macro (renderTableToList $title $entryLength $xpathExpression $entryNumber $tableId)
    #if($entryLength > 0)
        #renderGroupTitle($title)
        #foreach($entryNumber in [1..$entryLength])
            #set($entryType = $TOOL.getValueFromXPath("$xpathExpression[$entryNumber]/type"))
            #set($entryLink = $TOOL.getValueFromXPath("$xpathExpression[$entryNumber]/link"))
            
            #set($entrySize = $TOOL.getValueFromXPath("$xpathExpression[$entryNumber]/size"))
            #set($entryLabel = $TOOL.getValueFromXPath("$xpathExpression[$entryNumber]/label"))
            #if($entryLabel && $entryLabel.length() > 0 || $entryLink && $entryLink.length() > 0)
                <p>
                #if($entryLink && $entryLink.length() > 0)
                    <a class="link download" href="$entryLink" target="_blank" rel="noopener noreferrer">
                        <svg class="icon">
                            <use xlink:href="#internal-link"/>
                        </svg>
                        #if($entryLabel && $entryLabel.length() > 0)
                            $entryLabel
                        #else
                            $entryLink
                        #end
                    </a>
                #else
                    $entryLabel
                #end
                #if($entryLink && $entryLink.length() > 0)
                    <span class="tx-light">
                    (
                    #if($entryLink)
                        #set ($entryLinkSplit = $TOOL.getDecodeValue($entryLink).split("/"))
                        #set ($entryLinkSplitSize = $entryLinkSplit.size() - 1)
                        $entryLinkSplit.get($entryLinkSplitSize)
                    #end
                    <span class="downloadText"></span>
                    )
                    </span>
                #end
                </p>
            #end
            #set($entryType = "")
            #set($entrySize = "")
            #set($entryLink = "")
            #set($entryLabel = "")
        #end
    #end
#end

#macro (renderAccordionTitle $title)
    <h2 class="mq-hide-xxl">
        $title
        <svg class="filter__title__icon icon">
            <use xlink:href="#arrow-thick"/>
        </svg>
    </h2>
    <h3 class="mq-show-xxl">
        $title
        <svg class="filter__title__icon icon">
            <use xlink:href="#arrow-thick"/>
        </svg>
    </h3>
#end
<script>
    $( document ).ready(function() {
        $('a.download').each(function(index) {
            var a = $(this);
            var aParent = a.parent(); 
            if(a){
                if(a.length > 0){
                    var href = a[0].href;
                    var spanParent = aParent.find('span.text');
                    if(spanParent){
                        var span = spanParent.find('span.downloadText');
                        if(href && span){
                            getLinkFileSize('$restUrlHttpGet?url=' + encodeURIComponent(href), span);
                        }
                    }
                }
            }
        });
    });

    var lastId;
    var header = $('header');
    var topMenu = $(".nav-group");
    
    var menuItems = topMenu.find("a");

    var scrollItems = menuItems.map(function(){
        var item = $($(this).attr("href"));
        if (item.length) { return item; }
    });
    
    $(window).scroll(function(){
        var topMenuHeight = header.outerHeight() + 180;
        var fromTop = $(this).scrollTop() + topMenuHeight;
        var cur = scrollItems.map(function(){
            if ($(this).offset().top < fromTop)
                return this;
        });
 
        cur = cur[cur.length-1];
        var id = cur && cur.length ? cur[0].id : "";
        if (lastId !== id) {
            if(id !== "") {
                lastId = id;
                menuItems.removeClass("is-active");
                menuItems.filter("[href='#"+id+"']").addClass("is-active");
            }
        }
    });
</script>