## Area details
#set($x1 = $UTIL_SEARCH.getDetailValue( $rs.getHitDetail(), "x1" , 1))
#set($y1 = $UTIL_SEARCH.getDetailValue( $rs.getHitDetail(), "y1" , 1))
#set($x2 = $UTIL_SEARCH.getDetailValue( $rs.getHitDetail(), "x2" , 1))
#set($y2 = $UTIL_SEARCH.getDetailValue( $rs.getHitDetail(), "y2" , 1))

## Refering details
#set($referenceAllUUID = [])
#set($referenceAllName = [])
#set($referenceAllClass = [])
#set($referenceAllType = [])
#set($linksUrlRefDownload = [])
#set($linksUrlRefOthers = [])

#set($referingObjRefUUID = [])
#set($referingObjRefUUID = $rs.getHitDetail().get("refering.object_reference.obj_uuid"))
#set($referingObjRefName = [])
#set($referingObjRefName = $rs.getHitDetail().get("refering.object_reference.obj_name" ))
#set($referingObjRefClass = [])
#set($referingObjRefClass = $rs.getHitDetail().get("refering.object_reference.obj_class" ))
#set($referingObjRefType = [])
#set($referingObjRefType = $rs.getHitDetail().get("refering.object_reference.type" ))

#set($countObjRef = 0)
#foreach($objUuid in $referingObjRefUUID)
    #if($objUuid.startsWith("http"))
        #set($link = {})
        #set($add = $link.put("href", "$objUuid"))
        #if($referingObjRefName.get($countObjRef) && $referingObjRefObjName.get($countObjRef) != "")
            #set($add = $link.put("title", "$referingObjRefName.get($countObjRef)"))
        #else
            #set($add = $link.put("title", "$objUuid"))
        #end
        #set($add = $linksUrlRefOthers.add($link))
    #else
        #if(!$referenceAllUUID.contains($objUuid))
            #if(!$referingObjRefName.get($countObjRef).isEmpty())
                #set($add = $referenceAllUUID.add($objUuid))
                #set($add = $referenceAllName.add($referingObjRefName.get($countObjRef)))
                #set($add = $referenceAllClass.add($referingObjRefClass.get($countObjRef)))
                #set($add = $referenceAllType.add($referingObjRefType.get($countObjRef)))
            #end
        #end
    #end
    #set($countObjRef = $countObjRef + 1)
#end

#set($objRefUUID = [])
#set($objRefUUID = $rs.getHitDetail().get("object_reference.obj_uuid"))
#set($objRefName = [])
#set($objRefName = $rs.getHitDetail().get("object_reference.obj_name" ))
#set($objRefClass = [])
#set($objRefClass = $rs.getHitDetail().get("object_reference.obj_class" ))
#set($objRefType = [])
#set($objRefType = $rs.getHitDetail().get("object_reference.type" ))

#set($countObjRef = 0)
#foreach($objUuid in $objRefUUID)
    #if($objUuid.startsWith("http"))
        #set($link = {})
        #set($add = $link.put("href", "$objUuid"))
        #if($objRefName.get($countObjRef) && $objRefName.get($countObjRef) != "")
            #set($add = $link.put("title", "$objRefName.get($countObjRef)"))
        #else
            #set($add = $link.put("title", "$objUuid"))
        #end
        #set($add = $linksUrlRefOthers.add($link))
    #else
        #if(!$referenceAllUUID.contains($objUuid))
            #if(!$objRefName.get($countObjRef).isEmpty())
                #set($add = $referenceAllUUID.add($objUuid))
                #set($add = $referenceAllName.add($objRefName.get($countObjRef)))
                #set($add = $referenceAllClass.add($objRefClass.get($countObjRef)))
                #set($add = $referenceAllType.add($objRefType.get($countObjRef)))
            #end
        #end
    #end
    #set($countObjRef = $countObjRef + 1)
#end

## URLRefering details
#set($urlReferenceLink = $rs.getHitDetail().get("t017_url_ref.url_link"))
#set($urlReferenceContent = $rs.getHitDetail().get("t017_url_ref.content" ))
#set($urlReferenceSpecialRef = $rs.getHitDetail().get("t017_url_ref.special_ref" ))

#set($paramMore = $request.getParameter("more"))
#set($moreId = "${moreId}_more")
#set($isMoreId = false)
#if($paramMore.indexOf($moreId) > -1)
    #set($isMoreId = true)
#end
#if(($referenceAllUUID && $referenceAllUUID.size() > 0) || $urlReferenceLink || ($x1 && !$x1.isEmpty()))
    <a id="${moreId}" class="js-expander #if($isMoreId)is-hidden#end"" title="$MESSAGES.getString('searchResult.info.more')" href="#" #if($x1.isEmpty() == false && $y1.isEmpty() == false  && $x2.isEmpty() == false  && $y2.isEmpty() == false )onclick="resizeMap(map${moreId})"#end>
        <span class="icon  ic-ic-plus"></span>
        <span class="text">$MESSAGES.getString('searchResult.info.more')</span>
    </a>
    <a class="js-expander-close ${moreId} #if(!$isMoreId)is-hidden#end" title="$MESSAGES.getString('searchResult.info.less')" href="#">
        <span class="icon  ic-ic-minus"></span>
        <span class="text">$MESSAGES.getString('searchResult.info.less')</span>
    </a>
    <div class="js-expander-content ${moreId}" >
        <div class="row">
            <div class="xsmall-24 small-24 medium-14 large-14 xlarge-14 columns">
                #if($referenceAllUUID || $urlReferenceLink)
                    #set($linksRef = [])
                    #if($referenceAllUUID)
                        #set($refCount = 0)
                        #foreach($uuid in $referenceAllUUID)
                            #set($link = {})
                            #set($add = $link.put("href", "$renderResponse.encodeURL('/portal/search-detail.psml')?cmd=doShowDocument&docuuid=$referenceAllUUID.get($refCount)&plugid=$rs.plugid"))
                            #set($add = $link.put("type", "$referenceAllClass.get($refCount)"))
                            #set($add = $link.put("title", "$referenceAllName.get($refCount)"))
                            #set($add = $link.put("serviceType", "$referenceAllType.get($refCount)"))
                            #set($add = $linksRef.add($link))
                            #set($refCount = $refCount + 1)
                        #end
                    #end
                    #if($urlReferenceLink)
                        #set($refCount = 0)
                        #foreach($uuid in $urlReferenceLink)
                            #set($link = {})
                            #set($add = $link.put("href", "$urlReferenceLink.get($refCount)"))
                            #if($urlReferenceContent.get($refCount) && $urlReferenceContent.get($refCount) != "")
                                #set($add = $link.put("title", "$urlReferenceContent.get($refCount)"))
                            #else
                                #set($add = $link.put("title", "$urlReferenceLink.get($refCount)"))
                            #end
                            #set($tmpSpecialRef = $urlReferenceSpecialRef.get($refCount))
                            #set($add = $link.put("special_ref", $tmpSpecialRef))
                            #if($tmpSpecialRef && $tmpSpecialRef == "9990")
                                #set($add = $linksUrlRefDownload.add($link))
                            #else
                                #set($add = $linksUrlRefOthers.add($link))
                            #end
                            #set($refCount = $refCount + 1)
                        #end
                    #end
                    #if($linksUrlRefDownload.size() > 0 || $linksRef.size() > 0)
                        #set($countRefs = $linksUrlRefDownload.size() + $linksRef.size())
                        <h5>$MESSAGES.getString('searchResult.info.links') <span>($countRefs)</span></h5>
                        <div class="document-list">
                            #set($countRefsAll = 0)
                            #set($addRefsExpand = false)
                            #set($listLimit = 5)
                            #foreach($link in $sorter.sort($linksUrlRefDownload,"title"))
                                #if($countRefsAll >= $listLimit && $countRefs > $listLimit && $addRefsExpand == false)
                                    #set($addRefsExpand = true)
                                    <button type="button" id="${moreId}_links" class="js-expander button outline " title="$MESSAGES.getString('searchResult.info.links.more')" href="#">
                                        $MESSAGES.getString('searchResult.info.downloads.more')
                                    </button>
                                    <div class="js-expander-content ${moreId}_links is-hidden ">
                                #end
                                <div class="list-item">
                                    <div>
                                        #renderServiceTypeUrl($link.href $serviceTypes)
                                        <a href="$link.href" class="icon" title="$link.title">
                                            #if($link.special_ref == "9990")
                                                <span class="ic-ic-download"></span>
                                            #end
                                            <span class="text">$link.title</span>
                                        </a>
                                    </div>
                                </div>
                                #set($countRefsAll = $countRefsAll + 1)
                            #end
                            #foreach($link in $sorter.sort($linksRef,"title"))
                                #if($countRefsAll >= $listLimit && $countRefs > $listLimit && $addRefsExpand == false)
                                    #set($addRefsExpand = true)
                                    <button type="button" id="${moreId}_links" class="js-expander button outline " title="$MESSAGES.getString('searchResult.info.links.more')" href="#">
                                        $MESSAGES.getString('searchResult.info.links.more')
                                    </button>
                                    <div class="js-expander-content ${moreId}_links is-hidden ">
                                #end
                                <div class="list-item">
                                    #if($link.serviceType && !$link.serviceType.isEmpty())
                                        #if($serviceTypes.indexOf($link.serviceType) == -1)
                                            #set($add = $serviceTypes.add($link.serviceType))
                                        #end
                                        #renderServiceType($link.serviceType)
                                    #end
                                    <div>
                                        <a href="$link.href" class="icon" title="$link.title">
                                            #renderUDKIcon($link.type $link.title)
                                        </a>
                                    </div>
                                </div>
                                #set($countRefsAll = $countRefsAll + 1)
                            #end
                            #if($addRefsExpand)
                                #set($addRefsExpand = false)
                                </div>
                                <button type="button" class="button outline js-expander-close ${moreId}_links is-hidden" title="$MESSAGES.getString('searchResult.info.links.less')" href="#">
                                    $MESSAGES.getString('searchResult.info.links.less')
                                </button>
                            #end
                        </div>
                    #elseif($linksUrlRefOthers.size() > 0)
                        #set($countRefs = $linksUrlRefOthers.size())
                        <h5>$MESSAGES.getString('searchResult.info.links') <span>($countRefs)</span></h5>
                        <div class="document-list">
                            #set($countRefsAll = 0)
                            #set($addRefsExpand = false)
                            #set($listLimit = 5)
                            #foreach($link in $sorter.sort($linksUrlRefOthers,"title"))
                                #if($countRefsAll >= $listLimit && $countRefs > $listLimit && $addRefsExpand == false)
                                    #set($addRefsExpand = true)
                                    <button type="button" id="${moreId}_links" class="js-expander button outline " title="$MESSAGES.getString('searchResult.info.links.more')" href="#">
                                        $MESSAGES.getString('searchResult.info.links.more')
                                    </button>
                                    <div class="js-expander-content ${moreId}_links is-hidden ">
                                #end
                                <div class="list-item">
                                    <div>
                                        #renderServiceTypeUrl($link.href $serviceTypes)
                                        <a href="$link.href" class="icon" title="$link.title">
                                            #renderUDKIcon($link.type $link.title)
                                        </a>
                                    </div>
                                </div>
                                #set($countRefsAll = $countRefsAll + 1)
                            #end
                            #if($addRefsExpand)
                                #set($addRefsExpand = false)
                                </div>
                                <button type="button" class="button outline js-expander-close ${moreId}_links is-hidden" title="$MESSAGES.getString('searchResult.info.links.less')" href="#">
                                    $MESSAGES.getString('searchResult.info.links.less')
                                </button>
                            #end
                        </div>
                    #end
                    #set($licenseKey = $UTIL_SEARCH.getDetailValue( $rs.getHitDetail(), "object_use_constraint.license_key" , 1 ))
                    #set($licenseValue = $UTIL_SEARCH.getDetailValue( $rs.getHitDetail(), "object_use_constraint.license_value" , 1 ))
                    #if(($licenseKey && !$licenseKey.isEmpty()) || ($licenseValue && !$licenseValue.isEmpty()))
                        #set($licenseName = $Codelists.getCodeListValue('6500', $licenseKey, $languageCode))
                        #set($licenseUrl = $UTIL_SEARCH.getCodeListDataValue('6500', $licenseKey, "url", $request.getLocale()))
                        <h5>$MESSAGES.getString('searchResult.info.license')</h5>
                        #if($licenseUrl)
                            <a href="$licenseUrl" title="$licenseName">$licenseName</a>
                        #elseif($licenseName && !$licenseName.isEmpty())
                            <p>$licenseName</p>
                        #else
                            #if($licenseValue && !$licenseValue.isEmpty())
                                #set($licenseName = $UTIL_SEARCH.getCodeListDataStringValue($licenseValue, "name"))
                                #set($licenseUrl = $UTIL_SEARCH.getCodeListDataStringValue($licenseValue, "url"))
                                #if($licenseUrl && $licenseName)
                                    <a href="$licenseUrl" title="$licenseName">$licenseName</a>
                                #else
                                     <p>$licenseValue</p>
                                #end
                            #end
                        #end
                    #end
                    #if($rs.url)
                        <p>
                            <a href="$rs.url" title="$rs.url">$!rs.url_str</a>
                        </p>
                    #end
                    ##parse("/WEB-INF/templates/search-result/parts/search_result_ranked_hit_provider.vm")
                    ##parse("/WEB-INF/templates/search-result/parts/search_result_ranked_hit_source.vm")
                    <!--
                    #if($adminContent)
                        <h6 class="no-margin">Score</h6>
                        <p>
                            $rs.getScore()
                        </p>
                    #end
                    -->
                    ## do not show wms urls when they already have been displayed (above)
                    ##parse("/WEB-INF/templates/search-result/parts/search_result_ranked_hit_wms_url.vm")
        
                    ## render "Get XML"-link displayed next to the title
                    ##parse("/WEB-INF/templates/search-result/parts/search_result_ranked_hit_csw_xml.vm")
        
                    #if($rs.wms_coord)
                        <a class="button" href="$renderResponse.encodeURL('/portal/main-maps.psml')?$rs.wms_coord" title="$MESSAGES.getString('common.tooltip.link.extern.result')">$MESSAGES.getString('common.result.showCoord')</a>
                    #end
                #end
            </div>
            #if(($x1.isEmpty() == false && $y1.isEmpty() == false  && $x2.isEmpty() == false  && $y2.isEmpty() == false ) 
                || ($rs.additional_html_1 && !$rs.additional_html_1.isEmpty()))
            <div class="columns">
                #set($swipeSlides = [])
                #set($hasArea = false)
                #set($hasPreview = false)
                #set($hasSwipe = false)
                
                #if($x1.isEmpty() == false && $y1.isEmpty() == false  && $x2.isEmpty() == false  && $y2.isEmpty() == false )
                    #set($hasArea = true)
                #end
                
                #if($rs.additional_html_1 && !$rs.additional_html_1.isEmpty())
                    #set($hasPreview = true)
                #end
                
                #if($hasArea && $hasPreview)
                    #set($hasSwipe = true)
                #elseif($hasPreview && $!rs.additional_html_1.indexOf(">, <") > 0)
                    #set($hasSwipe = true)
                #end
                
                #if($hasSwipe)
                    <div class="swiper-container_${moreId} swiper-container">
                        <div class="swiper-wrapper">
                #end
                #if($hasPreview)
                    #if($!rs.additional_html_1.indexOf(">, <") == -1)
                        #if($hasSwipe)
                        <div class="swiper-slide">
                        #end
                        #set ($tmpValue = $!rs.additional_html_1)
                        #if($tmpValue.indexOf("src='http") > -1 && $tmpValue.indexOf("preview_image") > -1)
                            $tmpValue.replace('src', 'src="./" srcset').replace('preview_image', 'preview_image is-hidden')
                            <noscript>
                                $tmpValue
                            </noscript>
                        #else
                            $tmpValue
                        #end
                        #if($hasSwipe)
                        </div>
                        #end
                        #set($add = $swipeSlides.add("'$MESSAGES.getString('searchResult.info.preview')'"))
                    #else
                        #set($tmpValues = $!rs.additional_html_1.split(", "))
                        #foreach($tmpValue in $tmpValues)
                            <div class="swiper-slide">
                            #if($tmpValue.indexOf("src='http") > -1 && $tmpValue.indexOf("preview_image") > -1)
                                $tmpValue.replace('src', 'src="./" srcset').replace('preview_image', 'preview_image is-hidden')
                                <noscript>
                                    $tmpValue
                                </noscript>
                            #else
                                $tmpValue
                            #end
                            </div>
                            #set($add = $swipeSlides.add("'$MESSAGES.getString('searchResult.info.preview')'"))
                        #end
                    #end
                #end
                #if($hasSwipe)
                            <div class="swiper-slide">
                #end
                #if($hasArea)
                    #set($coords = [])
                    #set($mapId = $moreId)
                    #set($add = $coords.add(["'$rs.title'", $x1, $y1, $x2, $y2]))
                    #parse("/WEB-INF/templates/search-result/parts/search_result_ranked_hit_area.vm")
                    #set($add = $swipeSlides.add("'$MESSAGES.getString('searchResult.info.area')'"))
                #end
                #if($hasSwipe)
                            </div>
                        </div>
                        <div class="swiper-pagination"></div>
                    </div>
                    <script>
                      var swiper_${moreId} = new Swiper ('.swiper-container_${moreId}', {
                        spaceBetween: 10,
                        grabCursor: true,
                        updateOnWindowResize: true,
                        observer: true,
                        observeParents: true,
                        pagination: {
                          el: '.swiper-pagination',
                          clickable: true,
                          renderBullet: function (index, className) {
                            var swiperSlides = $swipeSlides;
                            return '<span class="' + className + '">' + swiperSlides[index] + '</span>';
                          }
                        }
                      });
                    </script>
                #end
            </div>
            #end
        </div>
    </div>
#end