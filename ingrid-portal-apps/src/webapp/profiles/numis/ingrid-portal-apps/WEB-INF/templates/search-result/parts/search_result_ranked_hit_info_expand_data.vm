#set($moreId = $hitCount)
#set($paramMore = $request.getParameter("more"))
#set($moreId = "${moreId}_more")
#set($isMoreId = false)
#if($paramMore && $paramMore.indexOf($moreId) > -1)
    #set($isMoreId = true)
#end
#set($isMoreIdLinks = false)
#set($moreIdLinks = "${moreId}_links")
#if($paramMore && $paramMore.indexOf($moreIdLinks) > -1)
    #set($isMoreIdLinks = true)
#end

## Area details
#set($coords = [])
#set($tmpX1 = $UTIL_SEARCH.getDetailValue( $rs.getHitDetail(), "x1" ))
#set($tmpY1 = $UTIL_SEARCH.getDetailValue( $rs.getHitDetail(), "y1" ))
#set($tmpX2 = $UTIL_SEARCH.getDetailValue( $rs.getHitDetail(), "x2" ))
#set($tmpY2 = $UTIL_SEARCH.getDetailValue( $rs.getHitDetail(), "y2" ))
#set($tmpLocation = $UTIL_SEARCH.getDetailValue( $rs.getHitDetail(), "location" ))
#if($tmpX1)
    #set($tmpCount = 0)
    #foreach($tmp in $tmpX1.split(","))
        #if($tmpLocation)
            #if($tmpCount < $tmpLocation.split(",").size())
                #set($tmpTitle = $tmpLocation.split(",").get($tmpCount))
            #else
                #set($tmpTitle = $rs.title)
            #end
        #else
            #set($tmpTitle = $rs.title)
        #end
        #set($add = $coords.add(["'$tmpTitle'", $tmpX1.split(",").get($tmpCount) , $tmpY1.split(",").get($tmpCount), $tmpX2.split(",").get($tmpCount), $tmpY2.split(",").get($tmpCount)]))
        #set($tmpCount = $tmpCount + 1)
    #end
#end
## Refering details
#set($referenceAllUUID = [])
#set($referenceAllName = [])
#set($referenceAllClass = [])
#set($referenceAllType = [])
#set($linksUrlRefDownload = [])
#set($linksUrlRefOthers = [])

#set($referingObjRefUUID = [])
#set($referingObjRefUUID = $rs.getHitDetail().get("refering.object_reference.obj_uuid"))
#set($referingObjRefName = [])
#set($referingObjRefName = $rs.getHitDetail().get("refering.object_reference.obj_name" ))
#set($referingObjRefClass = [])
#set($referingObjRefClass = $rs.getHitDetail().get("refering.object_reference.obj_class" ))
#set($referingObjRefType = [])
#set($referingObjRefType = $rs.getHitDetail().get("refering.object_reference.type" ))

#set($countObjRef = 0)
#foreach($objUuid in $referingObjRefUUID)
    #if($objUuid.startsWith("http"))
        #set($link = {})
        #set($add = $link.put("href", "$objUuid"))
        #if($referingObjRefName.get($countObjRef) && $referingObjRefObjName.get($countObjRef) != "")
            #set($add = $link.put("title", "$referingObjRefName.get($countObjRef)"))
        #else
            #set($add = $link.put("title", "$objUuid"))
        #end
        #set($add = $link.put("serviceType", $referingObjRefType.get($countObjRef)))
        #set($add = $linksUrlRefOthers.add($link))
    #else
        #if(!$referenceAllUUID.contains($objUuid))
            #if(!$referingObjRefName.get($countObjRef).isEmpty())
                #set($add = $referenceAllUUID.add($objUuid))
                #set($add = $referenceAllName.add($referingObjRefName.get($countObjRef)))
                #set($add = $referenceAllClass.add($referingObjRefClass.get($countObjRef)))
                #set($add = $referenceAllType.add($referingObjRefType.get($countObjRef)))
            #end
        #end
    #end
    #set($countObjRef = $countObjRef + 1)
#end

#set($objRefUUID = [])
#set($objRefUUID = $rs.getHitDetail().get("object_reference.obj_uuid"))
#set($objRefName = [])
#set($objRefName = $rs.getHitDetail().get("object_reference.obj_name" ))
#set($objRefClass = [])
#set($objRefClass = $rs.getHitDetail().get("object_reference.obj_class" ))
#set($objRefType = [])
#set($objRefType = $rs.getHitDetail().get("object_reference.type" ))

#set($countObjRef = 0)
#foreach($objUuid in $objRefUUID)
    #if($objUuid.startsWith("http"))
        #set($link = {})
        #set($add = $link.put("href", "$objUuid"))
        #if($objRefName.get($countObjRef) && $objRefName.get($countObjRef) != "")
            #set($add = $link.put("title", "$objRefName.get($countObjRef)"))
        #else
            #set($add = $link.put("title", "$objUuid"))
        #end
        #set($add = $link.put("serviceType", $objRefType.get($countObjRef)))
        #set($add = $linksUrlRefOthers.add($link))
    #else
        #if(!$referenceAllUUID.contains($objUuid))
            #if(!$objRefName.get($countObjRef).isEmpty())
                #set($add = $referenceAllUUID.add($objUuid))
                #set($add = $referenceAllName.add($objRefName.get($countObjRef)))
                #set($add = $referenceAllClass.add($objRefClass.get($countObjRef)))
                #set($add = $referenceAllType.add($objRefType.get($countObjRef)))
            #end
        #end
    #end
    #set($countObjRef = $countObjRef + 1)
#end

## URLRefering details
#set($urlReferenceLink = $rs.getHitDetail().get("t017_url_ref.url_link"))
#set($urlReferenceContent = $rs.getHitDetail().get("t017_url_ref.content"))
#set($urlReferenceSpecialRef = $rs.getHitDetail().get("t017_url_ref.special_ref"))
#set($urlReferenceDatatype = $rs.getHitDetail().get("t017_url_ref.datatype"))

#if($referenceAllUUID || $urlReferenceLink)
    #set($linksRef = [])
    #if($referenceAllUUID)
        #set($refCount = 0)
        #foreach($uuid in $referenceAllUUID)
            #set($link = {})
            #set($add = $link.put("href", "$renderResponse.encodeURL('/portal/search-detail.psml')?cmd=doShowDocument&docuuid=$referenceAllUUID.get($refCount)&plugid=$rs.plugid"))
            #set($add = $link.put("type", "$referenceAllClass.get($refCount)"))
            #set($add = $link.put("title", "$referenceAllName.get($refCount)"))
            #set($add = $link.put("serviceType", "$referenceAllType.get($refCount)"))

            ## Add service type to list 
            #if($link.serviceType != "" && $serviceTypes.indexOf($link.serviceType) == -1)
                #set($add = $serviceTypes.add($link.serviceType))
            #end

            #set($add = $linksRef.add($link))
            #set($refCount = $refCount + 1)
        #end
    #end
    #if($urlReferenceLink)
        #set($refCount = 0)
        #foreach($uuid in $urlReferenceLink)
            #set($link = {})
            #set($add = $link.put("href", "$urlReferenceLink.get($refCount)"))
            #if($urlReferenceContent.get($refCount) && $urlReferenceContent.get($refCount) != "")
                #set($add = $link.put("title", "$urlReferenceContent.get($refCount)"))
            #else
                #set($add = $link.put("title", "$urlReferenceLink.get($refCount)"))
            #end
            #set($tmpSpecialRef = $urlReferenceSpecialRef.get($refCount))
            #set($add = $link.put("special_ref", $tmpSpecialRef))
            #if($tmpSpecialRef && $tmpSpecialRef == "9990")
                #if($urlReferenceDatatype && $urlReferenceDatatype.size() && $urlReferenceDatatype.size() > $refCount)
                    #if($urlReferenceDatatype.get($refCount) && $urlReferenceDatatype.get($refCount) != "")
                        #set($add = $link.put("serviceType", "$urlReferenceDatatype.get($refCount)"))
                        #if($serviceTypes.indexOf($urlReferenceDatatype.get($refCount)) == -1)
                            #set($add = $serviceTypes.add($urlReferenceDatatype.get($refCount)))
                        #end
                    #end
                #end
                #set($add = $linksUrlRefDownload.add($link))
            #else
                ## Add service type to list
                #if($urlReferenceDatatype && $urlReferenceDatatype.size() && $urlReferenceDatatype.size() > $refCount)
                    #if($urlReferenceDatatype.get($refCount) && $urlReferenceDatatype.get($refCount) != "")
                        #if($serviceTypes.indexOf($urlReferenceDatatype.get($refCount)) == -1)
                            #set($add = $serviceTypes.add($urlReferenceDatatype.get($refCount)))
                        #end
                    #end
                #end
                #if($tmpSpecialRef == "3600" && $transformCoupledCSWUrl)
                    #set($add = $link.put("type", "1"))
                    #set($add = $link.put("href", "$renderResponse.encodeURL('/portal/search-detail.psml')?cswURL=$escTool.url($link.href)"))
                    #set($add = $linksRef.add($link))
                #else
                    #set($add = $linksUrlRefOthers.add($link))
                #end
            #end
            #set($refCount = $refCount + 1)
        #end
    #end
#end