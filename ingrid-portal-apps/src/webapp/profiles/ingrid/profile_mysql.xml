<?xml version="1.0" encoding="UTF-8"?>
<profile>
    <name>ingrid</name>
    <description>Portal-Profile f√ºr InGrid-Portal</description>
    <pages>
        <page>
            <name>main-measures.psml</name>
            <hidden>false</hidden>
        </page>
        <page>
            <name>main-measures.psml</name>
            <hidden>false</hidden>
        </page>
        <page>
            <name>main-chronicle.psml</name>
            <hidden>false</hidden>
        </page>
        <page>
            <name>main-maps.psml</name>
            <hidden>false</hidden>
        </page>
        <page>
            <name>service-sitemap.psml</name>
            <hidden>false</hidden>
        </page>
        <page>
            <name>administration/admin-content-rss.psml</name>
            <hidden>false</hidden>
        </page>
        <page>
            <name>administration/admin-homepage.psml</name>
            <hidden>false</hidden>
        </page>
        <page>
            <name>mdek/mdek_portal_admin.psml</name>
            <hidden>false</hidden>
        </page>
        <page>
            <name>main-about-partner.psml</name>
            <hidden>false</hidden>
        </page>
        <page>
            <name>main-about-data-source.psml</name>
            <hidden>false</hidden>
        </page>
        <page>
            <name>main-about.psml</name>
            <hidden>false</hidden>
        </page>
        <page>
            <name>cms/cms-0.psml</name>
            <hidden>true</hidden>
        </page>
        <page>
            <name>cms/cms-1.psml</name>
            <hidden>true</hidden>
        </page>
        <page>
            <name>cms/cms-2.psml</name>
            <hidden>true</hidden>
        </page>
        <page>
            <name>administration/admin-wms.psml</name>
            <hidden>false</hidden>
        </page>
        <page>
            <name>application/main-application.psml</name>
            <hidden>true</hidden>
        </page>
        <page>
            <name>default-page.psml</name>
            <hidden>false</hidden>
        </page>
        <page>
            <name>search-catalog/search-catalog-hierarchy.psml</name>
            <hidden>false</hidden>
        </page>
        <page>
            <name>service-contact.psml</name>
            <hidden>false</hidden>
        </page>
        <page>
            <name>disclaimer.psml</name>
            <hidden>false</hidden>
        </page>
      </pages>
    <files>
        <file>
            <action>copy-dir</action>
            <src>ingrid-portal/</src>
        </file>
        <file>
            <action>copy-dir</action>
            <src>ingrid-portal-apps/</src>
        </file>
        <file>
            <action>copy-dir</action>
            <src>ingrid-portal-mdek/</src>
        </file>
        <file>
            <action>copy-dir</action>
            <src>ingrid-portal-mdek-application/</src>
        </file>
        <file>
            <action>copy-dir</action>
            <src>ingrid-webmap-client/</src>
        </file>
    </files>
    <sql>
        <execute>
            <![CDATA[CREATE TABLE IF NOT EXISTS tmp_table (id bigint(20) NOT NULL AUTO_INCREMENT\, item_key varchar(255) COLLATE latin1_general_ci DEFAULT NULL\, item_value varchar(255) COLLATE latin1_general_ci DEFAULT NULL\, item_date timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP\, PRIMARY KEY (id));]]>
        </execute>
        <!-- Use ingrid_lookup table for temporary values (sub fragment) CAUSE CAN'T DO SUBSELECTS ON SAME TABLE (MySQL) !!! -->
        <!-- Remember id of sub fragment -->
        <execute>
            <![CDATA[INSERT INTO ingrid_lookup (item_key\, item_value) values ('tmp_layout_fragment_id'\, '0');]]>
        </execute>
        <execute>
            <![CDATA[UPDATE ingrid_lookup SET item_value = (SELECT fragment_id FROM fragment WHERE parent_id = (SELECT item_value FROM tmp_table WHERE item_key = 'tmp_id') AND name = 'jetspeed-layouts::IngridTwoColumns') WHERE item_key='tmp_layout_fragment_id';]]>
        </execute>
        <!-- Replace SearchNominatim portlet (BAW) with info portlet. Preferences still there (infoTemplate, titleKey). -->
        <execute>
            <![CDATA[UPDATE fragment SET name = 'ingrid-portal-apps::InfoPortlet' WHERE parent_id = (SELECT item_value FROM ingrid_lookup WHERE item_key = 'tmp_layout_fragment_id') AND name = 'ingrid-portal-apps::SearchNominatim';]]>
        </execute>
        <!-- then decorator -->
        <execute>
            <![CDATA[UPDATE fragment SET decorator = 'ingrid-marginal-header' WHERE parent_id = (SELECT item_value FROM ingrid_lookup WHERE item_key = 'tmp_layout_fragment_id') AND name = 'ingrid-portal-apps::InfoPortlet';]]>
        </execute>
        <!-- REMOVE SearchBWaStr portlet. NOTICE: We keep orphaned fragment preferences, should not matter. -->
        <execute>
            <![CDATA[DELETE FROM fragment WHERE NAME = 'ingrid-portal-apps::SearchBWaStr' AND PARENT_ID = (SELECT item_value FROM ingrid_lookup WHERE item_key = 'tmp_layout_fragment_id');]]>
        </execute>
        <!-- Remove temporary values from ingrid_lookup table -->
        <execute>
            <![CDATA[DELETE FROM ingrid_lookup WHERE item_key = 'tmp_layout_fragment_id';]]>
        </execute>
        <!-- Revert of replacing main-menu option "main-search" with "default-page" (BAW)-->
        <execute>
            <![CDATA[UPDATE folder_menu SET options = '/main-search.psml' WHERE options = '/default-page.psml' AND parent_id = (SELECT item_value FROM tmp_table WHERE item_key = 'main-menu_id');]]>
        </execute>
        <!-- Set folder "/cms" from display to hidden (only use on profile baw_wsv) -->
        <execute>
            <![CDATA[UPDATE folder SET is_hidden = 1 WHERE path = '/cms';]]>
        </execute>
        <execute>
            <![CDATA[UPDATE folder SET is_hidden = 1 WHERE path = '/application';]]>
        </execute>
        <!-- DONE with tmp_table -->
        <execute>
            <![CDATA[DROP TABLE tmp_table;]]>
        </execute>
    </sql>
</profile>
