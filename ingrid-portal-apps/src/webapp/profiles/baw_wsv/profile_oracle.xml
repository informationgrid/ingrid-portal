<?xml version="1.0" encoding="UTF-8"?>
<profile>
    <name>baw_wsv</name>
    <description>Portal-Profile GeoPortal.WSV</description>
    <pages>
        <page>
            <name>main-chronicle.psml</name>
            <hidden>true</hidden>
        </page>
        <page>
            <name>main-measures.psml</name>
            <hidden>true</hidden>
        </page>
        <page>
            <name>main-about.psml</name>
            <hidden>true</hidden>
        </page>
        <page>
            <name>cms/cms-1.psml</name>
            <hidden>true</hidden>
        </page>
        <page>
            <name>cms/cms-2.psml</name>
            <hidden>true</hidden>
        </page>
        <page>
            <name>mdek/mdek_portal_admin.psml</name>
            <hidden>true</hidden>
        </page>
        <page>
            <name>search-catalog/search-catalog-hierarchy.psml</name>
            <hidden>true</hidden>
        </page>
        <page>
            <name>application/main-application.psml</name>
            <hidden>false</hidden>
        </page>
        <page>
            <name>default-page.psml</name>
            <hidden>false</hidden>
            <portlets>
                <portlet col="0" row="0">
                    <name>ingrid-portal-apps::SearchSimple</name>
                </portlet>
                <portlet col="0" row="1">
                    <name>ingrid-portal-apps::ShortcutSearchQueryPortlet</name>
                </portlet>
                <portlet col="0" row="2">
                    <name>ingrid-portal-apps::IngridInformPortlet</name>
                </portlet>
                <portlet col="0" row="3">
                    <name>ingrid-portal-apps::CategoryTeaser</name>
                </portlet>
                <portlet col="0" row="4">
                    <name>ingrid-portal-apps::RssNewsTeaser</name>
                </portlet>
            </portlets>
        </page>
        <page>
            <name>_role/user/default-page.psml</name>
            <hidden>false</hidden>
            <portlets>
                <portlet col="0" row="0">
                    <name>ingrid-portal-apps::SearchSimple</name>
                </portlet>
                <portlet col="0" row="1">
                    <name>ingrid-portal-apps::ShortcutSearchQueryPortlet</name>
                </portlet>
                <portlet col="0" row="2">
                    <name>ingrid-portal-apps::IngridInformPortlet</name>
                </portlet>
                <portlet col="0" row="3">
                    <name>ingrid-portal-apps::CategoryTeaser</name>
                </portlet>
                <portlet col="0" row="4">
                    <name>ingrid-portal-apps::RssNewsTeaser</name>
                </portlet>
            </portlets>
        </page>
        <page>
            <name>_user/template/default-page.psml</name>
            <hidden>false</hidden>
            <portlets>
                <portlet col="0" row="0">
                    <name>ingrid-portal-apps::SearchSimple</name>
                </portlet>
                <portlet col="0" row="1">
                    <name>ingrid-portal-apps::ShortcutSearchQueryPortlet</name>
                </portlet>
                <portlet col="0" row="2">
                    <name>ingrid-portal-apps::IngridInformPortlet</name>
                </portlet>
                <portlet col="0" row="3">
                    <name>ingrid-portal-apps::CategoryTeaser</name>
                </portlet>
                <portlet col="0" row="4">
                    <name>ingrid-portal-apps::RssNewsTeaser</name>
                </portlet>
            </portlets>
        </page>
    </pages>
    <files>
        <file>
            <action>copy-dir</action>
            <src>ingrid-portal/</src>
        </file>
        <file>
            <action>copy-dir</action>
            <src>ingrid-portal-apps/</src>
        </file>
        <file>
            <action>copy-dir</action>
            <src>ingrid-webmap-client/</src>
        </file>
        <file>
            <action>copy-dir</action>
            <src>ingrid-webmap-client/frontend/src</src>
            <dst>ingrid-webmap-client/frontend/prd</dst>
        </file>
    </files>
    <sql>
        <execute>
            <![CDATA[CREATE TABLE tmp_table (item_key VARCHAR2(255 CHAR) DEFAULT NULL\, item_value VARCHAR2(255 CHAR) DEFAULT NULL\, item_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL)]]>
        </execute>
        <!-- Use ingrid_lookup table for temporary values (sub fragment) CAUSE CAN'T DO SUBSELECTS ON SAME TABLE (MySQL) !!! -->
        <!-- Remember id of sub fragment, ALSO ADD ID cause maybe no trigger set on null id ! -->
        <execute>
            <![CDATA[INSERT INTO ingrid_lookup (id\, item_key\, item_value) values (0\, 'tmp_layout_fragment_id'\, '0')]]>
        </execute>
        <execute>
            <![CDATA[UPDATE ingrid_lookup SET item_value = (SELECT fragment_id FROM fragment WHERE parent_id = (SELECT item_value FROM tmp_table WHERE item_key = 'tmp_id') AND name = 'jetspeed-layouts::IngridTwoColumns') WHERE item_key='tmp_layout_fragment_id']]>
        </execute>
        <!-- Change decorator in sub fragment -->
        <execute>
            <![CDATA[UPDATE fragment SET decorator = 'ingrid-marginal-teaser' WHERE parent_id = (SELECT item_value FROM ingrid_lookup WHERE item_key = 'tmp_layout_fragment_id') AND name = 'ingrid-portal-apps::InfoPortlet']]>
        </execute>
        <!-- Also replace info portlet with SearchNominatim portlet. Preferences can be kept (infoTemplate, titleKey), not used. -->
        <execute>
            <![CDATA[UPDATE fragment SET name = 'ingrid-portal-apps::SearchNominatim' WHERE parent_id = (SELECT item_value FROM ingrid_lookup WHERE item_key = 'tmp_layout_fragment_id') AND name = 'ingrid-portal-apps::InfoPortlet']]>
        </execute>
        <!-- Remove temporary values from ingrid_lookup table -->
        <execute>
            <![CDATA[DELETE FROM ingrid_lookup WHERE item_key = 'tmp_layout_fragment_id']]>
        </execute>
        <!-- Set folder from hidden to display -->
        <execute>
            <![CDATA[UPDATE folder SET is_hidden = 0 WHERE path = '/cms']]>
        </execute>
        <execute>
            <![CDATA[UPDATE folder SET is_hidden = 0 WHERE path = '/application']]>
        </execute>
        <!-- DONE with tmp_table -->
        <execute>
            <![CDATA[DROP TABLE tmp_table]]>
        </execute>
        <!-- Disable language switcher -->
        <execute>
            <![CDATA[UPDATE link SET IS_HIDDEN='1' WHERE PATH='/language.link']]>
        </execute>
        <!-- Delete user default-page.psml -->
        <execute>
            <![CDATA[DELETE FROM page WHERE PATH LIKE '/_user/%/default-page.psml' AND NOT PATH = '/_user/template/default-page.psml']]>
        </execute>
    </sql>
</profile>
